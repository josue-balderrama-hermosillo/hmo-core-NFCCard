<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <title>AR App — Josue Balderrama</title>
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="WebAR viewer that launches a hosted 8th Wall experience; tap-to-start with fullscreen fallback." />

  <style>
    :root { --brand:#FF6A00; --ink:#e5e7eb; }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif; background:#000; color:#fff }

    /* Full-viewport stage (edge-to-edge, phone-like) */
    .stage { position: fixed; inset: 0; background:#000 }
    iframe { position:absolute; inset:0; width:100%; height:100%; border:0 }

    /* Tap-to-start overlay (large format) */
    #tapToStart {
      position: fixed; inset: 0; display: grid; place-items: center;
      padding: max(24px, env(safe-area-inset-top)) max(24px, env(safe-area-inset-right)) max(24px, env(safe-area-inset-bottom)) max(24px, env(safe-area-inset-left));
      background: radial-gradient(1200px 1200px at 50% 50%, rgba(15,23,42,.92) 0%, rgba(0,0,0,.95) 60%, rgba(0,0,0,1) 100%);
      z-index: 10; text-align: center;
    }
    #tapToStart.hidden { display:none }
    .hero {
      max-width: 540px; width: min(92vw, 540px);
      display: grid; gap: 16px; align-items: center; justify-items: center;
    }
    .title { font-size: clamp(20px, 3.6vw, 28px); margin: 0; font-weight: 800; letter-spacing:.2px }
    .sub { margin: 0; opacity:.85; font-size: clamp(14px, 2.6vw, 16px) }
    .btn {
      display:inline-block; background: var(--brand); color:#fff; font-weight:800; letter-spacing:.3px;
      padding: 1rem 1.25rem; border-radius: 16px; border:0; cursor:pointer; width: 100%;
      max-width: 420px; font-size: clamp(16px, 3.2vw, 18px);
      box-shadow: 0 10px 30px rgba(255,106,0,.25);
    }
    .hint {
      margin-top: 8px; font-size: 12px; opacity:.7;
    }

    /* Fallback when iframe is blocked */
    #fallback {
      position:absolute; inset:0; display:none; place-items:center; text-align:center;
      background: rgba(2,6,23,.9); z-index: 5; padding: 24px;
    }
    #fallback.visible { display:grid }
    .link-btn {
      display:inline-block; background: var(--brand); color:#fff; font-weight:800;
      padding:.9rem 1.1rem; border-radius: 14px; text-decoration:none;
    }
  </style>
</head>

<body>
  <!-- Fullscreen AR stage -->
  <div class="stage">
    <iframe id="arFrame"
      title="8th Wall WebAR"
      allow="camera; microphone; gyroscope; accelerometer; magnetometer; xr-spatial-tracking; fullscreen; autoplay; clipboard-write; geolocation; web-share"
      referrerpolicy="no-referrer-when-downgrade"
      sandbox="allow-scripts allow-same-origin allow-forms allow-popups">
    </iframe>

    <!-- Fallback if embedding is blocked -->
    <div id="fallback">
      <div>
        <h2 style="margin:0 0 .35rem;font-size:20px">Open the AR experience full screen</h2>
        <p style="opacity:.8;margin:.25rem 0 1rem">Some mobile browsers require AR to run outside an iframe.</p>
        <p><a id="fallbackLink" class="link-btn" target="_blank" rel="noopener">Launch AR</a></p>
        <p style="font-size:12px;opacity:.65;margin-top:.5rem">If nothing happens, ensure HTTPS and allow camera access.</p>
      </div>
    </div>
  </div>

  <!-- Large “phone-style” tap-to-start overlay -->
  <div id="tapToStart" role="dialog" aria-modal="true" aria-label="Tap to start">
    <div class="hero">
      <h1 class="title">Tap to Start AR</h1>
      <p class="sub">We’ll request camera right away so you can aim at your presentation card.</p>
      <button id="startBtn" class="btn" type="button">Start AR</button>
      <p class="hint">Tip: good lighting helps the tracker lock on your card.</p>
    </div>
  </div>

  <script>
    // ===== Config =====
    // Your 8th Wall share URL from data-8code="75ewg"
    const AR_URL = "https://8th.io/75ewg";

    const startBtn     = document.getElementById('startBtn');
    const tapOverlay   = document.getElementById('tapToStart');
    const frame        = document.getElementById('arFrame');
    const fallback     = document.getElementById('fallback');
    const fallbackLink = document.getElementById('fallbackLink');

    fallbackLink.href = AR_URL;

    // On iOS 13+ you may also need a motion permission; ask politely on tap.
    async function requestMotionIfNeeded() {
      const DME = window.DeviceMotionEvent;
      if (DME && typeof DME.requestPermission === 'function') {
        try { return (await DME.requestPermission()) === 'granted'; } catch { return false; }
      }
      return true;
    }

    async function startAR() {
      // Ensure a user gesture before loading the AR origin (so camera prompt fires immediately).
      await requestMotionIfNeeded();

      tapOverlay.classList.add('hidden');

      // Try to embed; many providers accept ?embed=1 for nicer in-frame behavior.
      const tryUrl = AR_URL + (AR_URL.includes('?') ? '&' : '?') + 'embed=1';
      let loaded = false;

      frame.addEventListener('load', () => { loaded = true; }, { once:true });
      frame.src = tryUrl;

      // If no load within 3.5s, assume embedding is blocked → show fullscreen fallback.
      setTimeout(() => { if (!loaded) fallback.classList.add('visible'); }, 3500);
    }

    startBtn.addEventListener('click', startAR, { once:true });
  </script>
</body>
</html>
